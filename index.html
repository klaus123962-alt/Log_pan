<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è–º–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
        }
        
        header {
            background-color: #001355;
            color: white;
            padding: 8px 12px;
            text-align: center;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            min-height: 60px;
        }
        
        @media (max-width: 768px) {
            header {
                padding: 6px 8px;
                margin-bottom: 8px;
                min-height: 50px;
            }
        }
        
        .logo {
            position: absolute;
            top: 10px;
            right: 10px;
            height: 30px;
            width: auto;
        }
        
        @media (max-width: 768px) {
            .logo {
                height: 25px;
                top: 8px;
                right: 8px;
            }
        }
        
        h1 {
            font-size: clamp(16px, 3.5vw, 20px);
            margin-bottom: 4px;
            font-weight: 600;
            padding: 0 5px;
            margin-top: 5px;
        }
        
        header p {
            font-size: clamp(11px, 2.5vw, 13px);
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: clamp(11px, 2.5vw, 13px);
            padding: 10px;
            border-top: 1px solid #eee;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border: 1px solid #eaeaea;
        }
        
        @media (max-width: 768px) {
            .card {
                padding: 12px;
            }
        }
        
        .card h2 {
            color: #001355;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: clamp(15px, 3vw, 17px);
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
            font-size: clamp(13px, 2.8vw, 14px);
        }
        
        textarea, select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: clamp(14px, 3vw, 15px);
            transition: border-color 0.3s;
            background: #fff;
            min-height: 44px;
        }
        
        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: #001355;
            box-shadow: 0 0 0 2px rgba(0, 19, 85, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            textarea {
                min-height: 80px;
            }
        }
        
        input[type="date"] {
            max-width: 100%;
            padding: 10px;
        }
        
        .btn {
            background-color: #001355;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(14px, 3vw, 15px);
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            flex: 1;
        }
        
        .btn:hover, .btn:active {
            background-color: #002677;
        }
        
        .btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background-color: #545b62;
        }
        
        .voice-btn {
            background-color: #28a745;
            margin-left: 8px;
            padding: 10px 12px;
            min-width: auto;
            flex-shrink: 0;
            flex: 0;
        }
        
        .voice-btn:hover, .voice-btn:active {
            background-color: #218838;
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .btn-group {
                gap: 6px;
            }
        }
        
        .task-list {
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 5px;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 768px) {
            .task-list {
                max-height: 40vh;
            }
        }
        
        .task-item {
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid #e9ecef;
        }
        
        .task-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .task-item.in-progress {
            border-left-color: #ffc107;
        }
        
        .task-item.completed {
            border-left-color: #28a745;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            align-items: flex-start;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .task-id {
            font-size: clamp(10px, 2.2vw, 11px);
            color: #666;
            margin-top: 2px;
        }
        
        .task-priority {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: clamp(10px, 2.2vw, 11px);
            font-weight: bold;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .priority-high { background: #dc3545; color: white; }
        .priority-normal { background: #007bff; color: white; }
        .priority-low { background: #6c757d; color: white; }
        .priority-urgent { background: #dc3545; color: white; }
        
        .operator-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
            flex-shrink: 0;
        }
        
        .status-free { background-color: #28a745; }
        .status-busy { background-color: #dc3545; }
        
        .operators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 768px) {
            .operators-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                max-height: 180px;
            }
        }
        
        .operator-card {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
            font-size: clamp(12px, 2.5vw, 13px);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: clamp(13px, 2.8vw, 15px);
        }
        
        .notification {
            position: fixed;
            top: max(15px, env(safe-area-inset-top));
            right: max(15px, env(safe-area-inset-right));
            left: max(15px, env(safe-area-inset-left));
            padding: 12px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            text-align: center;
            font-size: clamp(13px, 2.8vw, 14px);
            backdrop-filter: blur(5px);
        }
        
        @media (max-width: 768px) {
            .notification {
                margin: 8px;
                top: 8px;
                right: 8px;
                left: 8px;
                padding: 10px;
            }
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .refresh-btn {
            background-color: #17a2b8;
            margin-left: 8px;
            padding: 8px 12px;
            min-width: auto;
            flex: 0;
        }
        
        .refresh-btn:hover, .refresh-btn:active {
            background-color: #138496;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: clamp(10px, 2.2vw, 11px);
            font-weight: bold;
            margin-right: 6px;
            flex-shrink: 0;
        }
        
        .status-new { background: #007bff; color: white; }
        .status-in_progress { background: #ffc107; color: #000; }
        .status-completed { background: #28a745; color: white; }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: #6c757d;
            font-size: clamp(13px, 2.8vw, 15px);
        }
        
        .empty-state div:first-child {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .date-filter-container {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .date-filter-container {
                gap: 6px;
            }
        }
        
        .date-filter-container label {
            margin-bottom: 0;
            white-space: nowrap;
            font-size: clamp(12px, 2.5vw, 13px);
        }
        
        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í –û–î–ò–ù –†–Ø–î */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(4, 1fr);
                gap: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: repeat(4, 1fr);
                gap: 4px;
            }
        }
        
        .stat-card {
            background: white;
            padding: 10px 8px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border: 1px solid #eaeaea;
            min-width: 0;
            overflow: hidden;
        }
        
        @media (max-width: 480px) {
            .stat-card {
                padding: 8px 6px;
            }
        }
        
        .stat-card div:first-child {
            font-size: clamp(10px, 2.2vw, 11px);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .stat-value {
            font-size: clamp(16px, 3.5vw, 18px);
            font-weight: bold;
            margin: 6px 0;
            line-height: 1.2;
        }
        
        @media (max-width: 480px) {
            .stat-value {
                font-size: clamp(14px, 3vw, 16px);
                margin: 4px 0;
            }
        }
        
        .stat-card div:last-child {
            font-size: clamp(9px, 2vw, 10px);
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .stat-new { color: #007bff; }
        .stat-in_progress { color: #ffc107; }
        .stat-completed { color: #28a745; }
        .stat-total { color: #001355; }
        
        .time-info {
            font-size: clamp(10px, 2.2vw, 11px);
            color: #666;
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid #eee;
        }
        
        .env-badge {
            position: absolute;
            top: 8px;
            left: 10px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: clamp(9px, 2vw, 10px);
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .env-badge {
                position: static;
                display: inline-block;
                margin-bottom: 5px;
            }
        }
        
        .env-local { background: #28a745; color: white; }
        .env-production { background: #dc3545; color: white; }
        .env-development { background: #ffc107; color: #000; }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .mobile-controls {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
                justify-content: space-between;
                margin-bottom: 12px;
                gap: 6px;
                background: white;
                padding: 8px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .mobile-tab {
                flex: 1;
                text-align: center;
                padding: 10px 5px;
                background: white;
                border-radius: 6px;
                border: 2px solid #001355;
                font-weight: 600;
                font-size: clamp(12px, 2.5vw, 13px);
                color: #001355;
                cursor: pointer;
                transition: all 0.3s;
                min-height: 40px;
            }
            
            .mobile-tab.active {
                background: #001355;
                color: white;
            }
            
            .desktop-only {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-only {
                display: none;
            }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (hover: none) and (pointer: coarse) {
            .btn, .task-item, .operator-card, .stat-card {
                cursor: default;
            }
            
            select, input[type="date"], textarea {
                font-size: 16px;
            }
        }
        
        /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è iOS */
        .task-list, .operators-grid, .stats-container {
            -webkit-overflow-scrolling: touch;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
        }
        
        /* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
        @media (max-width: 360px) {
            .container {
                padding: 5px;
            }
            
            .btn {
                padding: 10px;
                font-size: 13px;
            }
            
            .stats-container {
                gap: 3px;
            }
            
            .stat-card {
                padding: 6px 4px;
            }
            
            .stat-card div:first-child {
                font-size: 10px;
            }
            
            .stat-value {
                font-size: 14px;
            }
            
            .stat-card div:last-child {
                font-size: 9px;
            }
        }
        
        /* –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .voice-btn-container {
                display: flex;
                align-items: flex-start;
                gap: 8px;
            }
            
            .voice-btn-container textarea {
                flex: 1;
            }
            
            .mobile-form-stats {
                margin-top: 15px;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span id="env-badge" class="env-badge env-production">–ü–†–û–î–ê–ö–®–ù</span>
            <img src="http://irtz.ru/PC/pc.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo">
            <h1>–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø–ú–ò</h1>
            <p>–°–æ–∑–¥–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—á–∏—Ö –∑–∞–¥–∞–Ω–∏–π</p>
        </header>
        
        <!-- –°–∫—Ä—ã—Ç—ã–π —Ä–∞–∑–¥–µ–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="config-panel card" style="display: none;">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç–æ)</h2>
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ... -->
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
        <div class="mobile-controls">
            <button class="mobile-tab active" data-tab="create">–°–æ–∑–¥–∞—Ç—å</button>
            <button class="mobile-tab" data-tab="tasks">–ó–∞–¥–∞–Ω–∏—è</button>
            <button class="mobile-tab" data-tab="operators">–û–ø–µ—Ä–∞—Ç–æ—Ä—ã</button>
        </div>
        
        <div class="dashboard">
            <div class="card" id="create-tab">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
                
                <div class="form-group">
                    <label for="user-role">–í—ã –∫—Ç–æ?</label>
                    <select id="user-role">
                        <option value="–ù–∞—á–∞–ª—å–Ω–∏–∫ —Å–º–µ–Ω—ã">–ù–∞—á–∞–ª—å–Ω–∏–∫ —Å–º–µ–Ω—ã</option>
                        <option value="–ö–ª–∞–¥–æ–≤—â–∏–∫">–ö–ª–∞–¥–æ–≤—â–∏–∫</option>
                        <option value="–î–∏—Å–ø–µ—Ç—á–µ—Ä">–î–∏—Å–ø–µ—Ç—á–µ—Ä</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="task-description">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è:</label>
                    <div class="voice-btn-container">
                        <textarea id="task-description" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ..."></textarea>
                        <button type="button" id="voice-btn" class="btn voice-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
                            üé§
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                    <select id="priority">
                        <option value="–û–±—ã—á–Ω—ã–π">–û–±—ã—á–Ω—ã–π</option>
                        <option value="–í—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
                        <option value="–ù–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                        <option value="–°—Ä–æ—á–Ω—ã–π">–°—Ä–æ—á–Ω—ã–π</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="assign-to">–ù–∞–∑–Ω–∞—á–∏—Ç—å —Å—Ä–∞–∑—É:</label>
                    <select id="assign-to">
                        <option value="">–í –æ–±—â–∏–π –ø—É–ª (–ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä)</option>
                        <!-- –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
                <div class="mobile-form-stats mobile-only">
                    <div class="stats-container">
                        <div class="stat-card">
                            <div>–í—Å–µ–≥–æ</div>
                            <div class="stat-value stat-total" id="mobile-total">0</div>
                            <div>–∑–∞–¥–∞–Ω–∏–π</div>
                        </div>
                        <div class="stat-card">
                            <div>–ù–æ–≤—ã–µ</div>
                            <div class="stat-value stat-new" id="mobile-new">0</div>
                            <div>–æ–∂–∏–¥–∞—é—Ç</div>
                        </div>
                        <div class="stat-card">
                            <div>–í —Ä–∞–±–æ—Ç–µ</div>
                            <div class="stat-value stat-in_progress" id="mobile-in-progress">0</div>
                            <div>—Å–µ–π—á–∞—Å</div>
                        </div>
                        <div class="stat-card">
                            <div>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            <div class="stat-value stat-completed" id="mobile-completed">0</div>
                            <div>–≤—ã–ø–æ–ª–Ω–µ–Ω—ã</div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button id="create-task-btn" class="btn">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                    <button id="clear-form" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="card desktop-only" id="operators-tab">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>–°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</h2>
                    <button id="refresh-operators" class="btn refresh-btn" title="–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å">‚ü≥</button>
                </div>
                <div id="operators-container">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤...</div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –º–æ–±–∏–ª–µ) -->
        <div class="stats-container desktop-only" id="stats-container">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="card" id="tasks-tab">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h2 style="margin-bottom: 0;">–í—Å–µ –∑–∞–¥–∞–Ω–∏—è</h2>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button id="today-btn" class="btn" style="background-color: #28a745; flex: 0;">–°–µ–≥–æ–¥–Ω—è</button>
                    <button id="refresh-tasks" class="btn refresh-btn" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫">‚ü≥</button>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–¥–∞–Ω–∏–π (–º–æ–±–∏–ª—å–Ω–∞—è) -->
            <div class="stats-container mobile-only" id="mobile-tasks-stats" style="margin-bottom: 15px;">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="date-filter-container">
                <label for="date-filter">–î–∞—Ç–∞:</label>
                <input type="date" id="date-filter" style="flex: 1;">
                <button id="apply-filter" class="btn" style="flex: 0.5;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <button id="clear-filter" class="btn btn-secondary" style="flex: 0.5;">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <span style="font-size: clamp(11px, 2.5vw, 12px); color: #666; white-space: nowrap; margin-left: auto;">
                    –í—Å–µ–≥–æ: <span id="tasks-count">0</span>
                </span>
            </div>
            
            <div id="all-tasks-container" class="task-list">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</div>
            </div>
        </div>
        
        <div class="footer">
            <p>–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –ò—Ä–∫—É—Ç—Å–∫–∏–º —Ç—Ä—É–±–Ω—ã–º –∑–∞–≤–æ–¥–æ–º</p>
            <p>–¢–µ–∫—É—â–∏–π API: <span id="current-api-url" style="font-family: monospace; word-break: break-all; font-size: 11px;">https://tunnel.itrz.ru/webhook</span></p>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    const SERVERS = [
        {
            name: '–õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å',
            url: 'http://10.141.120.18:8000',
            badgeClass: 'env-local',
            badgeText: '–õ–û–ö–ê–õ–¨–ù–ê–Ø –°–ï–¢–¨',
            testEndpoint: '/get-tasks'
        },
        {
            name: '–ü—Ä–æ–¥–∞–∫—à–Ω',
            url: 'https://tunnel.itrz.ru/webhook',
            badgeClass: 'env-production',
            badgeText: '–ü–†–û–î–ê–ö–®–ù',
            testEndpoint: '/get-tasks'
        }
    ];
    
    let CONFIG = {
        currentEnv: localStorage.getItem('currentEnv') || 'auto',
        customUrl: localStorage.getItem('customUrl') || 'https://tunnel.itrz.ru/webhook',
        detectedServer: null,
        n8nBaseUrl: 'https://tunnel.itrz.ru/webhook'
    };
    
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const elements = {
        userRole: document.getElementById('user-role'),
        taskDescription: document.getElementById('task-description'),
        priority: document.getElementById('priority'),
        assignTo: document.getElementById('assign-to'),
        createTaskBtn: document.getElementById('create-task-btn'),
        clearFormBtn: document.getElementById('clear-form'),
        voiceBtn: document.getElementById('voice-btn'),
        operatorsContainer: document.getElementById('operators-container'),
        allTasksContainer: document.getElementById('all-tasks-container'),
        notification: document.getElementById('notification'),
        currentApiUrl: document.getElementById('current-api-url'),
        refreshTasksBtn: document.getElementById('refresh-tasks'),
        refreshOperatorsBtn: document.getElementById('refresh-operators'),
        dateFilter: document.getElementById('date-filter'),
        applyFilterBtn: document.getElementById('apply-filter'),
        clearFilterBtn: document.getElementById('clear-filter'),
        todayBtn: document.getElementById('today-btn'),
        tasksCount: document.getElementById('tasks-count'),
        statsContainer: document.getElementById('stats-container'),
        envBadge: document.getElementById('env-badge'),
        // –ú–æ–±–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        mobileTabs: document.querySelectorAll('.mobile-tab'),
        createTab: document.getElementById('create-tab'),
        operatorsTab: document.getElementById('operators-tab'),
        tasksTab: document.getElementById('tasks-tab'),
        // –ú–æ–±–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        mobileTotal: document.getElementById('mobile-total'),
        mobileNew: document.getElementById('mobile-new'),
        mobileInProgress: document.getElementById('mobile-in-progress'),
        mobileCompleted: document.getElementById('mobile-completed'),
        mobileTasksStats: document.getElementById('mobile-tasks-stats')
    };
    
    let allTasks = [];
    let isMobile = window.innerWidth <= 768;
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
        initializeApp();
        setupEventListeners();
        setupMobileNavigation();
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        autoDetectServer();
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä–∞–∑–º–µ—Ä—É —ç–∫—Ä–∞–Ω–∞
        window.addEventListener('resize', handleResize);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞—Ç—É —Å–µ–≥–æ–¥–Ω—è
        const today = new Date().toISOString().split('T')[0];
        elements.dateFilter.value = today;
    });
    
    function initializeApp() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å –ø—É—Å—Ç—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
        elements.assignTo.innerHTML = '<option value="">–í –æ–±—â–∏–π –ø—É–ª (–ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä)</option>';
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        if (isMobile) {
            showMobileTab('create');
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        loadOperatorsToSelect();
        
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
    }
    
    function setupEventListeners() {
        console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
        elements.createTaskBtn.addEventListener('click', function(e) {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ');
            createTask();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–æ—Ä–º—ã
        elements.clearFormBtn.addEventListener('click', function(e) {
            console.log('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –û—á–∏—Å—Ç–∏—Ç—å');
            clearForm();
        });
        
        elements.voiceBtn.addEventListener('click', startVoiceRecognition);
        elements.refreshTasksBtn.addEventListener('click', () => {
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π...');
            loadTasks().catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π', true);
            });
        });
        elements.refreshOperatorsBtn.addEventListener('click', () => {
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤...');
            loadOperators().catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤', true);
            });
        });
        elements.applyFilterBtn.addEventListener('click', filterTasks);
        elements.clearFilterBtn.addEventListener('click', clearFilter);
        elements.todayBtn.addEventListener('click', setTodayFilter);
        
        console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
    }
    
    function setupMobileNavigation() {
        if (!isMobile) return;
        
        elements.mobileTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                showMobileTab(tabName);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
                elements.mobileTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }
    
    function showMobileTab(tabName) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
        elements.createTab.style.display = 'none';
        elements.operatorsTab.style.display = 'none';
        elements.tasksTab.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
        switch(tabName) {
            case 'create':
                elements.createTab.style.display = 'block';
                break;
            case 'operators':
                elements.operatorsTab.style.display = 'block';
                loadOperators();
                break;
            case 'tasks':
                elements.tasksTab.style.display = 'block';
                loadTasks();
                break;
        }
    }
    
    function handleResize() {
        const wasMobile = isMobile;
        isMobile = window.innerWidth <= 768;
        
        if (wasMobile !== isMobile) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º—ã
            if (isMobile) {
                document.querySelectorAll('.desktop-only').forEach(el => {
                    el.style.display = 'none';
                });
                document.querySelectorAll('.mobile-only').forEach(el => {
                    el.style.display = 'block';
                });
                showMobileTab('create');
            } else {
                document.querySelectorAll('.desktop-only').forEach(el => {
                    el.style.display = 'block';
                });
                document.querySelectorAll('.mobile-only').forEach(el => {
                    el.style.display = 'none';
                });
                elements.createTab.style.display = 'block';
                elements.operatorsTab.style.display = 'block';
                elements.tasksTab.style.display = 'block';
            }
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
    async function autoDetectServer() {
        console.log('–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...');
        showNotification('–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...');
        
        for (let i = 0; i < SERVERS.length; i++) {
            const server = SERVERS[i];
            const testUrl = server.url + server.testEndpoint;
            
            try {
                console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${testUrl}`);
                const response = await fetch(testUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                if (response.ok) {
                    // –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω!
                    CONFIG.detectedServer = server;
                    CONFIG.n8nBaseUrl = server.url;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    elements.currentApiUrl.textContent = server.url;
                    elements.envBadge.className = `env-badge ${server.badgeClass}`;
                    elements.envBadge.textContent = server.badgeText;
                    
                    console.log(`–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É: ${server.name}`);
                    showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    loadData();
                    return;
                }
            } catch (error) {
                console.log(`–°–µ—Ä–≤–µ—Ä ${server.name} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:`, error.message);
            }
        }
        
        // –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
        console.error('–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
        showNotification('–°–µ—Ä–≤–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.', true);
        elements.envBadge.className = 'env-badge env-production';
        elements.envBadge.textContent = '–û–®–ò–ë–ö–ê';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        elements.operatorsContainer.innerHTML = `
            <div class="empty-state">
                <div>‚ö†Ô∏è</div>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
            </div>
        `;
        
        elements.allTasksContainer.innerHTML = `
            <div class="empty-state">
                <div>‚ö†Ô∏è</div>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</p>
                <small>–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</small>
            </div>
        `;
    }
    
    async function createTask() {
        const description = elements.taskDescription.value.trim();
        if (!description) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è', true);
            return;
        }
        
        const taskData = {
            description: description,
            priority: elements.priority.value,
            created_by: elements.userRole.value,
            assigned_to: elements.assignTo.value || ""
        };
        
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è:', taskData);
        
        try {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            elements.createTaskBtn.disabled = true;
            elements.createTaskBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            const response = await fetch(CONFIG.n8nBaseUrl + '/create-task', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(taskData)
            });
            
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
            
            if (!response.ok) {
                let errorText = 'HTTP –æ—à–∏–±–∫–∞: ' + response.status;
                try {
                    const errorData = await response.text();
                    console.log('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorData);
                    errorText += ': ' + errorData;
                } catch (e) {}
                throw new Error(errorText);
            }
            
            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
            clearForm();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            await loadData();
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞: ' + error.message, true);
        } finally {
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(() => {
                elements.createTaskBtn.disabled = false;
                elements.createTaskBtn.textContent = '–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
            }, 1000);
        }
    }
    
    function startVoiceRecognition() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            showNotification('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥', true);
            return;
        }
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.lang = 'ru-RU';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
        elements.voiceBtn.disabled = true;
        elements.voiceBtn.textContent = 'üé§...';
        elements.voiceBtn.style.backgroundColor = '#dc3545';
        
        recognition.start();
        showNotification('–ì–æ–≤–æ—Ä–∏—Ç–µ...');
        
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            elements.taskDescription.value = transcript;
            showNotification('–¢–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω');
        };
        
        recognition.onerror = function(event) {
            console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', event.error);
            showNotification('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è', true);
        };
        
        recognition.onend = function() {
            elements.voiceBtn.disabled = false;
            elements.voiceBtn.textContent = 'üé§';
            elements.voiceBtn.style.backgroundColor = '#28a745';
        };
    }
    
    function clearForm() {
        console.log('–û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã');
        elements.taskDescription.value = '';
        elements.priority.value = '–û–±—ã—á–Ω—ã–π';
        elements.assignTo.value = '';
        showNotification('–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞');
    }
    
    async function fetchData(endpoint) {
        const url = CONFIG.n8nBaseUrl + endpoint;
        console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö: ${url}`);
        
        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
            
        } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${endpoint}:`, error);
            throw error;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–≤–µ—Ç–∞ n8n
    function extractDataFromN8nResponse(responseData) {
        let dataArray = [];
        
        if (Array.isArray(responseData)) {
            if (responseData.length > 0 && responseData[0] && responseData[0].json) {
                dataArray = responseData.map(item => item.json);
            } else {
                dataArray = responseData;
            }
        }
        else if (responseData && responseData.data && Array.isArray(responseData.data)) {
            dataArray = responseData.data;
        }
        else if (responseData && responseData.json && Array.isArray(responseData.json)) {
            dataArray = responseData.json;
        }
        else if (responseData && typeof responseData === 'object') {
            if (responseData.id || responseData.name || responseData.description) {
                dataArray = [responseData];
            }
        }
        
        return dataArray;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
    async function loadOperatorsToSelect() {
        try {
            const url = CONFIG.n8nBaseUrl + '/get-operators';
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Å–ø–∏—Å–∫–∞:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
            }
            
            const responseData = await response.json();
            let operatorsArray = extractDataFromN8nResponse(responseData);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            updateOperatorsSelect(operatorsArray);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Å–ø–∏—Å–∫–∞:', error);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
            const backupOperators = [
                { name: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.' },
                { name: '–ü–µ—Ç—Ä–æ–≤ –ü.–ü.' },
                { name: '–°–∏–¥–æ—Ä–æ–≤ –°.–°.' },
                { name: '–í–∞—Å–∏–ª—å–µ–≤ –í.–í.' },
                { name: '–ê–ª–µ–∫—Å–µ–µ–≤ –ê.–ê.' }
            ];
            
            updateOperatorsSelect(backupOperators);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
    function updateOperatorsSelect(operators) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const currentValue = elements.assignTo.value;
        
        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
        elements.assignTo.innerHTML = '<option value="">–í –æ–±—â–∏–π –ø—É–ª (–ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä)</option>';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        if (Array.isArray(operators) && operators.length > 0) {
            operators.forEach(operator => {
                if (operator && operator.name) {
                    const option = document.createElement('option');
                    option.value = operator.name;
                    option.textContent = operator.name;
                    elements.assignTo.appendChild(option);
                }
            });
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (currentValue && Array.from(elements.assignTo.options).some(opt => opt.value === currentValue)) {
            elements.assignTo.value = currentValue;
        }
    }
    
    async function loadOperators() {
        try {
            elements.operatorsContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤...</div>';
            
            const url = CONFIG.n8nBaseUrl + '/get-operators';
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
            }
            
            const responseData = await response.json();
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞
            let operatorsArray = [];
            
            if (Array.isArray(responseData)) {
                operatorsArray = responseData;
            }
            else if (responseData && Array.isArray(responseData.data)) {
                operatorsArray = responseData.data;
            }
            else if (responseData && Array.isArray(responseData.json)) {
                operatorsArray = responseData.json;
            }
            else if (responseData && typeof responseData === 'object') {
                if (responseData.id || responseData.name) {
                    operatorsArray = [responseData];
                }
                else {
                    for (const key in responseData) {
                        if (Array.isArray(responseData[key])) {
                            operatorsArray = responseData[key];
                            break;
                        }
                    }
                }
            }
            
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:', operatorsArray.length);
            
            if (!Array.isArray(operatorsArray) || operatorsArray.length === 0) {
                elements.operatorsContainer.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞—Ö</div>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ –∏–º–µ–Ω–∏
            operatorsArray.sort((a, b) => {
                if (a.status === 'free' && b.status !== 'free') return -1;
                if (a.status !== 'free' && b.status === 'free') return 1;
                return (a.name || '').localeCompare(b.name || '');
            });
            
            renderOperators(operatorsArray);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:', error);
            elements.operatorsContainer.innerHTML = `
                <div class="empty-state">
                    <div>‚ö†Ô∏è</div>
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</p>
                </div>
            `;
        }
    }
    
    function renderOperators(operators) {
        if (!Array.isArray(operators) || operators.length === 0) {
            elements.operatorsContainer.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞—Ö</div>';
            return;
        }
        
        let html = '<div class="operators-grid">';
        
        operators.forEach(operator => {
            if (!operator) return;
            
            const status = operator.status || 'free';
            const statusClass = status === 'free' ? 'status-free' : 'status-busy';
            const statusText = status === 'free' ? '–°–≤–æ–±–æ–¥–µ–Ω' : '–ó–∞–Ω—è—Ç';
            const operatorName = operator.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const taskId = operator.current_task_id;
            
            html += `
                <div class="operator-card">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 5px;">
                        <div class="operator-status ${statusClass}"></div>
                        <strong style="font-size: inherit;">${operatorName}</strong>
                    </div>
                    <div style="font-size: 11px; color: ${status === 'free' ? '#28a745' : '#dc3545'};">
                        ${statusText}
                    </div>
                    ${taskId ? 
                        `<div style="font-size: 10px; color: #666; margin-top: 3px;">
                            ID: ${taskId}
                        </div>` : ''
                    }
                </div>
            `;
        });
        
        html += '</div>';
        elements.operatorsContainer.innerHTML = html;
    }
    
    async function loadData() {
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...');
        
        try {
            await Promise.all([
                loadTasks().catch(e => {
                    console.error('–û—à–∏–±–∫–∞ –≤ loadTasks:', e);
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π', true);
                }),
                loadOperators().catch(e => {
                    console.error('–û—à–∏–±–∫–∞ –≤ loadOperators:', e);
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤', true);
                })
            ]);
            console.log('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        }
    }
    
    async function loadTasks() {
        try {
            elements.allTasksContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</div>';
            
            const url = CONFIG.n8nBaseUrl + '/get-tasks';
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π:', url);
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
            }
            
            const responseData = await response.json();
            
            let tasksArray = [];
            
            if (Array.isArray(responseData)) {
                tasksArray = responseData;
            }
            else if (responseData && Array.isArray(responseData.data)) {
                tasksArray = responseData.data;
            }
            else if (responseData && Array.isArray(responseData.json)) {
                tasksArray = responseData.json;
            }
            else if (responseData && typeof responseData === 'object') {
                if (responseData.id || responseData.description) {
                    tasksArray = [responseData];
                }
                else {
                    for (const key in responseData) {
                        if (Array.isArray(responseData[key])) {
                            tasksArray = responseData[key];
                            break;
                        }
                    }
                }
            }
            
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π:', tasksArray.length);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            tasksArray.sort((a, b) => {
                const dateA = new Date(a.created_at || 0);
                const dateB = new Date(b.created_at || 0);
                return dateB - dateA;
            });
            
            allTasks = tasksArray;
            filterTasks();
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π:', error);
            elements.allTasksContainer.innerHTML = `
                <div class="empty-state">
                    <div>‚ö†Ô∏è</div>
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π</p>
                </div>
            `;
        }
    }
    
    function filterTasks() {
        const dateFilter = elements.dateFilter.value;
        let filteredTasks = allTasks || [];
        
        if (dateFilter && allTasks && allTasks.length > 0) {
            filteredTasks = allTasks.filter(task => {
                if (!task || !task.created_at) return false;
                try {
                    const taskDate = new Date(task.created_at).toISOString().split('T')[0];
                    return taskDate === dateFilter;
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã:', task.created_at);
                    return false;
                }
            });
        }
        
        elements.tasksCount.textContent = filteredTasks.length;
        
        if (filteredTasks.length === 0) {
            elements.allTasksContainer.innerHTML = `
                <div class="empty-state">
                    <div>üìù</div>
                    <p>–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</p>
                    <small>${dateFilter ? '–ù–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É' : '–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è'}</small>
                </div>
            `;
            renderStats([]);
        } else {
            renderTasks(filteredTasks);
            renderStats(filteredTasks);
        }
    }
    
    function clearFilter() {
        elements.dateFilter.value = '';
        filterTasks();
    }
    
    function setTodayFilter() {
        const today = new Date().toISOString().split('T')[0];
        elements.dateFilter.value = today;
        filterTasks();
    }
    
    function renderStats(tasks) {
        if (!Array.isArray(tasks)) {
            tasks = [];
        }
        
        const stats = {
            total: tasks.length,
            new: tasks.filter(t => t && t.status === 'new').length,
            in_progress: tasks.filter(t => t && t.status === 'in_progress').length,
            completed: tasks.filter(t => t && t.status === 'completed').length
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        if (!isMobile) {
            const desktopHtml = `
                <div class="stat-card">
                    <div>–í—Å–µ–≥–æ</div>
                    <div class="stat-value stat-total">${stats.total}</div>
                    <div>–∑–∞–¥–∞–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div>–ù–æ–≤—ã–µ</div>
                    <div class="stat-value stat-new">${stats.new}</div>
                    <div>–æ–∂–∏–¥–∞—é—Ç</div>
                </div>
                <div class="stat-card">
                    <div>–í —Ä–∞–±–æ—Ç–µ</div>
                    <div class="stat-value stat-in_progress">${stats.in_progress}</div>
                    <div>—Å–µ–π—á–∞—Å</div>
                </div>
                <div class="stat-card">
                    <div>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                    <div class="stat-value stat-completed">${stats.completed}</div>
                    <div>–≤—ã–ø–æ–ª–Ω–µ–Ω—ã</div>
                </div>
            `;
            
            elements.statsContainer.innerHTML = desktopHtml;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–±–∏–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è
        elements.mobileTotal.textContent = stats.total;
        elements.mobileNew.textContent = stats.new;
        elements.mobileInProgress.textContent = stats.in_progress;
        elements.mobileCompleted.textContent = stats.completed;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–±–∏–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–¥–∞–Ω–∏–π
        const mobileTasksHtml = `
            <div class="stat-card">
                <div>–í—Å–µ–≥–æ</div>
                <div class="stat-value stat-total">${stats.total}</div>
                <div>–∑–∞–¥–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div>–ù–æ–≤—ã–µ</div>
                <div class="stat-value stat-new">${stats.new}</div>
                <div>–æ–∂–∏–¥–∞—é—Ç</div>
            </div>
            <div class="stat-card">
                <div>–í —Ä–∞–±–æ—Ç–µ</div>
                <div class="stat-value stat-in_progress">${stats.in_progress}</div>
                <div>—Å–µ–π—á–∞—Å</div>
            </div>
            <div class="stat-card">
                <div>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                <div class="stat-value stat-completed">${stats.completed}</div>
                <div>–≤—ã–ø–æ–ª–Ω–µ–Ω—ã</div>
            </div>
        `;
        
        elements.mobileTasksStats.innerHTML = mobileTasksHtml;
    }
    
    function renderTasks(tasks) {
        if (!Array.isArray(tasks) || tasks.length === 0) {
            return;
        }
        
        let html = '';
        
        tasks.forEach(task => {
            if (!task) return;
            
            const priorityClass = getPriorityClass(task.priority);
            const priorityText = task.priority || '–û–±—ã—á–Ω—ã–π';
            const statusClass = `status-${task.status || 'new'}`;
            const statusText = getStatusText(task.status);
            const createdDate = formatDate(task.created_at);
            const acceptedDate = task.accepted_at ? formatDate(task.accepted_at) : '';
            const completedDate = task.completed_at ? formatDate(task.completed_at) : '';
            
            let taskClass = '';
            if (task.status === 'completed') taskClass = 'completed';
            else if (task.status === 'in_progress') taskClass = 'in-progress';
            
            html += `
                <div class="task-item ${taskClass}">
                    <div class="task-header">
                        <div style="flex: 1; min-width: 0;">
                            <strong style="display: block; font-size: clamp(13px, 2.8vw, 14px); margin-bottom: 2px;">${task.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</strong>
                            <div class="task-id">ID: ${task.id || '–ù/–î'}</div>
                        </div>
                        <span class="task-priority ${priorityClass}">${priorityText}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: clamp(11px, 2.5vw, 12px);">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        <span style="color: #666;"> | </span>
                        <strong>–°–æ–∑–¥–∞–ª:</strong> ${task.created_by || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                        <span style="color: #666;"> | </span>
                        <strong>–ò—Å–ø–æ–ª–Ω.:</strong> ${task.assigned_to || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}
                        <span style="color: #666;"> | </span>
                        <strong>–°–æ–∑–¥–∞–Ω–æ:</strong> ${createdDate.split(' ')[0]}
                    </div>
                    ${acceptedDate ? `
                        <div class="time-info">
                            <strong>–ü—Ä–∏–Ω—è—Ç–æ:</strong> ${acceptedDate} ${task.accepted_by ? `(${task.accepted_by})` : ''}
                        </div>
                    ` : ''}
                    ${completedDate ? `
                        <div class="time-info">
                            <strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> ${completedDate}
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        elements.allTasksContainer.innerHTML = html;
    }
    
    function getPriorityClass(priority) {
        const map = {
            '–í—ã—Å–æ–∫–∏–π': 'priority-high',
            '–°—Ä–æ—á–Ω—ã–π': 'priority-urgent',
            '–ù–∏–∑–∫–∏–π': 'priority-low',
            '–û–±—ã—á–Ω—ã–π': 'priority-normal'
        };
        return map[priority] || 'priority-normal';
    }
    
    function getStatusText(status) {
        const map = {
            'new': '–ù–æ–≤–æ–µ',
            'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
            'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'
        };
        return map[status] || status || '–ù–æ–≤–æ–µ';
    }
    
    function formatDate(dateString) {
        if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (e) {
            console.warn('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', dateString);
            return dateString;
        }
    }
    
    function showNotification(message, isError = false) {
        elements.notification.textContent = message;
        elements.notification.className = `notification ${isError ? 'error' : ''}`;
        elements.notification.style.display = 'block';
        
        setTimeout(() => {
            elements.notification.style.display = 'none';
        }, 4000);
    }
    
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(loadData, 30000);
    
    console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');
    </script>
</body>
</html>
